name: Publish to GH Pages
on:
  release:
    types: [published]

jobs:
    publish-pages:
      name: Publish to GH Pages
      runs-on: ubuntu-latest
      steps:
          - name: Checkout Source Code
            uses: actions/checkout@v2
          - name: Checkout GH Pages
            uses: actions/checkout@v2
            with:
              repository: sQUlearn/squlearn.github.io
              path: "docs/_build"
              token: ${{ secrets.GITHUB_TOKEN }}
          - name: Build Docs
            uses: sQUlearn/sphinx-action@master
            with:
              docs-folder: "docs/"
              pre-build-command: "pip3 install ."
              build-command: "sphinx-build -b html . _build -W"
          - name: Commit Files
            run: |
              cd docs/_build
              git config --global user.email "github-actions[bot]@users.noreply.github.com"
              git config --global user.name "github-actions[bot]"
              git add .
              git commit -m "update documentation ${{ github.event.release.tag_name }}"
              git tag -a "${{ github.event.release.tag_name }}" -m "${{ github.event.release.name}}"
          - name: Push Changes
            uses: ad-m/github-push-action@master
            with:
              directory: docs/_build
              repository: sQUlearn/squlearn.github.io
